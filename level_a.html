<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Açº§ç‰¹è®­ï¼šäºŒæ¬¡å‡½æ•°å›¾åƒä¸æ€§è´¨</title>
    
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            startup: {
                pageReady: () => {
                    return MathJax.startup.defaultPageReady();
                }
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.bootcdn.net/ajax/libs/mathjax/3.2.2/es5/tex-chtml.min.js"></script>

    <style>
        :root {
            --primary: #512da8; /* Açº§ä½¿ç”¨æ·±ç´«è‰²ï¼Œä»£è¡¨è¿›é˜¶ */
            --quiz: #00796b;    /* æµ‹è¯•åŒºé’è‰² */
            --remedy: #f57c00;  /* è¡¥æ•‘æ©™ */
            --deep: #c62828;    /* æ·±åº¦çº¢ */
            --bg: #f3e5f5;      /* æµ…ç´«èƒŒæ™¯ */
            --card: #ffffff;
        }

        body { font-family: 'Segoe UI', 'PingFang SC', sans-serif; background: var(--bg); margin: 0; padding: 20px; line-height: 1.6; color: #333; }
        .container { max-width: 800px; margin: 0 auto; }
        
        /* åœºæ™¯åˆ‡æ¢ */
        .scene { display: none; animation: fadeIn 0.5s; }
        .scene.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* å¡ç‰‡æ ·å¼ */
        .card { background: var(--card); padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 20px; }
        
        h1, h2, h3 { margin-top: 0; color: #2c3e50; }
        
        /* æŒ‰é’® */
        .btn {
            display: inline-block; padding: 12px 24px; border-radius: 6px; cursor: pointer; border: none; font-size: 1rem; color: white; transition: 0.2s;
            width: 100%; text-align: left; margin-bottom: 10px;
        }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-primary { background: var(--primary); text-align: center; font-weight: bold; width: auto; }
        
        .btn-opt { background: white; color: #333; border: 2px solid #e0e0e0; }
        .btn-opt:hover { background: #e1bee7; border-color: var(--primary); }
        .btn-opt.selected { background: #e1bee7; border-color: var(--primary); color: var(--primary); font-weight: bold; }
        .disabled { pointer-events: none; opacity: 0.6; }

        /* Phase 1 æ•™å­¦åŒº */
        .study-header { border-left: 5px solid var(--primary); padding-left: 15px; margin-bottom: 20px; }
        .knowledge-point { background: #f3e5f5; border: 1px dashed var(--primary); padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .key-tag { background: var(--primary); color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; margin-right: 5px; }

        /* SVG å›¾ç¤ºæ¡† */
        .svg-demo { text-align: center; margin: 10px 0; background: white; border-radius: 8px; padding: 10px; border: 1px solid #ddd; }

        /* Phase 3 è¡¥æ•‘åŒº */
        .remedy-header { background: #fff3e0; color: #e65100; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #ffe0b2; }
        .deep-dive-box {
            display: none; background: #ffebee; border: 2px dashed var(--deep); padding: 15px; border-radius: 8px; margin-top: 15px; animation: slideDown 0.5s;
        }
        @keyframes slideDown { from { opacity:0; transform:translateY(-10px); } to { opacity:1; transform:translateY(0); } }
        .step-item { margin-bottom: 8px; padding-left: 10px; border-left: 3px solid var(--deep); }

        /* è¿›åº¦æ¡ */
        .progress-bar { height: 8px; background: #e0e0e0; border-radius: 4px; margin-bottom: 20px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--quiz); width: 0%; transition: width 0.3s; }
    </style>
</head>
<body>

<div class="container">

    <div id="scene-study" class="scene active">
        <div class="card">
            <div class="study-header">
                <h1>Açº§ï¼šå›¾åƒä¸æ€§è´¨ (æ•°å½¢ç»“åˆ)</h1>
                <p>è¿™ä¸€å…³çš„æ ¸å¿ƒæ˜¯â€œçœ‹å›¾è¯´è¯â€ã€‚è¯·åŠ¡å¿…æŒæ¡ä»¥ä¸‹ 3 å¤§çœ‹å›¾æŠ€å·§ã€‚</p>
            </div>
            
            <div class="knowledge-point">
                <h3><span class="key-tag">æŠ€å·§1</span>$a, b, c$ çš„å‡ ä½•æ„ä¹‰</h3>
                <ul>
                    <li><strong>$a$ (å¼€å£)ï¼š</strong> $a>0$ ç¬‘è„¸(å‘ä¸Š)ï¼Œ$a<0$ å“­è„¸(å‘ä¸‹)ã€‚$|a|$ è¶Šå¤§å£è¶Šå°ã€‚</li>
                    <li><strong>$b$ (å¯¹ç§°è½´)ï¼š</strong> å…¬å¼ $x = -\frac{b}{2a}$ã€‚<br><strong>å£è¯€ï¼šå·¦åŒå³å¼‚ã€‚</strong><br>(å¯¹ç§°è½´åœ¨yè½´å·¦ä¾§ $\rightarrow$ $a,b$åŒå·ï¼›å³ä¾§ $\rightarrow$ $a,b$å¼‚å·)ã€‚</li>
                    <li><strong>$c$ (æˆªè·)ï¼š</strong> æŠ›ç‰©çº¿ä¸ $y$ è½´äº¤ç‚¹æ˜¯ $(0, c)$ã€‚</li>
                </ul>
                <div class="svg-demo">
                    <svg width="200" height="100" viewBox="-100 -50 200 100">
                        <line x1="-90" y1="40" x2="90" y2="40" stroke="#888" stroke-width="1"/>
                        <line x1="0" y1="-40" x2="0" y2="50" stroke="#888" stroke-width="1"/>
                        <path d="M -50 -40 Q 20 100 70 -40" stroke="#512da8" stroke-width="2" fill="none"/>
                        <text x="-90" y="-30" font-size="10" fill="#333">a>0, b<0 (å³å¼‚), c<0</text>
                    </svg>
                </div>
            </div>

            <div class="knowledge-point">
                <h3><span class="key-tag">æŠ€å·§2</span>å¹³ç§»å£è¯€ (é’ˆå¯¹é¡¶ç‚¹)</h3>
                <p><strong>å·¦åŠ å³å‡ (æ‹¬å·å†…)ï¼Œä¸ŠåŠ ä¸‹å‡ (æ‹¬å·å¤–)</strong></p>
                <p>ä¾‹ï¼š$y=ax^2$ $\xrightarrow{å³å¹³ç§»h}$ $y=a(x-h)^2$ $\xrightarrow{ä¸Šå¹³ç§»k}$ $y=a(x-h)^2+k$</p>
            </div>

            <div class="knowledge-point">
                <h3><span class="key-tag">æŠ€å·§3</span>äº¤ç‚¹ä¸åˆ¤åˆ«å¼ $\Delta$</h3>
                <p>æŠ›ç‰©çº¿ä¸ $x$ è½´çš„äº¤ç‚¹ä¸ªæ•°ç”± $\Delta = b^2-4ac$ å†³å®šï¼š</p>
                <ul>
                    <li>$\Delta > 0$ $\rightarrow$ 2ä¸ªäº¤ç‚¹</li>
                    <li>$\Delta = 0$ $\rightarrow$ 1ä¸ªäº¤ç‚¹ (é¡¶ç‚¹åœ¨xè½´)</li>
                    <li>$\Delta < 0$ $\rightarrow$ 0ä¸ªäº¤ç‚¹ (æ‚¬ç©º)</li>
                </ul>
            </div>

            <button class="btn btn-primary" style="width:100%; margin-top:20px;" onclick="startQuiz()">æˆ‘å­¦ä¼šäº†ï¼Œå¼€å§‹çœ‹å›¾æŒ‘æˆ˜ â¡</button>
        </div>
    </div>

    <div id="scene-quiz" class="scene">
        <div class="card">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <span style="font-weight:bold; color:var(--quiz);">Açº§ è¿›é˜¶æµ‹è¯•</span>
                <span id="quiz-progress-text">1 / 6</span>
            </div>
            <div class="progress-bar"><div class="progress-fill" id="quiz-progress-fill"></div></div>

            <h3 id="quiz-question-text">...</h3>
            <div id="quiz-options-container"></div>
            <button id="quiz-next-btn" class="btn btn-primary" style="margin-top:20px; display:none;">ä¸‹ä¸€é¢˜</button>
        </div>
    </div>

    <div id="scene-remedy" class="scene">
        <div class="card" style="border-top: 5px solid var(--remedy);">
            <div class="remedy-header">
                <h3>âš ï¸ å›¾åƒè¯Šæ–­æ¨¡å¼</h3>
                <p>ä½ çš„â€œæ•°å½¢ç»“åˆâ€èƒ½åŠ›è¿˜æœ‰æ¼æ´ï¼Œè¯·å®Œæˆä¿®å¤ã€‚</p>
            </div>

            <div style="margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:15px;">
                <p><strong>âŒ åŸé¢˜å›é¡¾ï¼š</strong> <span id="remedy-original-question">...</span></p>
                <div style="background:#fff3e0; padding:15px; border-radius:8px; color:#555;">
                    <strong>ğŸ“– è€å¸ˆè§£æï¼š</strong> <span id="remedy-explanation">...</span>
                </div>
            </div>

            <h4 style="color:var(--remedy);">âœï¸ å˜å¼æŒ‘æˆ˜ï¼š</h4>
            <p id="variant-question-text" style="font-weight:bold;">...</p>
            <div id="variant-options-container"></div>
            
            <div id="deep-dive-box" class="deep-dive-box">
                <h4 style="color:var(--deep); margin-top:0;">ğŸš¨ ä¾ç„¶åšé”™ï¼Ÿå¯åŠ¨ã€åˆ†æ­¥æ‹†è§£ã€‘</h4>
                <div id="deep-steps"></div>
                <div style="margin-top:15px; text-align:right;">
                    <button class="btn btn-primary" style="background:var(--deep); width:auto;" onclick="retryVariant()">ğŸ”„ é‡åšæ­¤é¢˜</button>
                </div>
            </div>

            <div id="variant-feedback" style="margin-top:15px; font-weight:bold; min-height:30px;"></div>
            <button id="remedy-next-btn" class="btn btn-primary" style="margin-top:20px; display:none;" onclick="nextRemedyItem()">ä¸‹ä¸€é¡¹è¯Šæ–­ â¡</button>
        </div>
    </div>

    <div id="scene-result" class="scene">
        <div class="card" style="text-align: center;">
            <div style="font-size: 4em; margin-bottom: 10px;">ğŸ¨</div>
            <h2>Açº§ç‰¹è®­ç»“æŸ</h2>
            <div id="result-details" style="text-align: left; margin: 20px 0; background: #f5f5f5; padding: 20px; border-radius: 8px;"></div>
            <button class="btn btn-primary" onclick="location.reload()">å†æ¥ä¸€æ¬¡</button>
        </div>
    </div>

</div>

<script>
    // =========================================================
    // Açº§æ ¸å¿ƒé¢˜åº“ï¼šå›¾åƒä¸æ€§è´¨
    // =========================================================
    const questionBank = [
        // ã€A-01 å¼€å£ä¸å®½åº¦ã€‘
        {
            id: "A-01", type: "main",
            question: "å…³äºæŠ›ç‰©çº¿ $ y = -3x^2 $ï¼Œä¸‹åˆ—è¯´æ³•æ­£ç¡®çš„æ˜¯ï¼Ÿ",
            options: ["å¼€å£å‘ä¸Šï¼Œæ¯” $y=-x^2$ å®½", "å¼€å£å‘ä¸‹ï¼Œæ¯” $y=-x^2$ å®½", "å¼€å£å‘ä¸Šï¼Œæ¯” $y=-x^2$ çª„", "å¼€å£å‘ä¸‹ï¼Œæ¯” $y=-x^2$ çª„"],
            correct: 3, 
            remediation: {
                explanation: "1. ç³»æ•° $-3 < 0$ï¼Œæ‰€ä»¥å¼€å£<strong>å‘ä¸‹</strong>ã€‚<br>2. ç»å¯¹å€¼ $|-3| = 3$ï¼Œè€Œ $|-1|=1$ã€‚<br>3. <strong>ç»å¯¹å€¼è¶Šå¤§ï¼Œå¼€å£è¶Šå°ï¼ˆè¶Šçª„ï¼‰</strong>ã€‚æ‰€ä»¥æ¯” $y=-x^2$ çª„ã€‚",
                variant: {
                    question: "æ¯”è¾ƒ $ y=\\frac{1}{2}x^2 $ å’Œ $ y=2x^2 $ çš„å›¾åƒï¼Œæ­£ç¡®çš„æ˜¯ï¼Ÿ",
                    options: ["å‰è€…å¼€å£å¤§ï¼ˆå®½ï¼‰", "åè€…å¼€å£å¤§ï¼ˆå®½ï¼‰", "ä¸€æ ·å®½", "æ— æ³•æ¯”è¾ƒ"],
                    correct: 0
                },
                stepByStep: [
                    "ç¬¬ä¸€æ­¥ï¼šçœ‹ç³»æ•°ç»å¯¹å€¼ã€‚$|1/2| = 0.5$ï¼Œ $|2| = 2$ã€‚",
                    "ç¬¬äºŒæ­¥ï¼šè®°å¿†å£è¯€â€”â€”ç³»æ•°è¶Šå°ï¼Œå¼€å£è¶Šé˜”ï¼ˆå®½ï¼‰ï¼›ç³»æ•°è¶Šå¤§ï¼Œå¼€å£è¶Šé™¡ï¼ˆçª„ï¼‰ã€‚",
                    "ç¬¬ä¸‰æ­¥ï¼š$0.5 < 2$ï¼Œæ‰€ä»¥ $y=\\frac{1}{2}x^2$ çš„å¼€å£æ›´å®½ã€‚"
                ]
            }
        },
        // ã€A-02 å¯¹ç§°è½´ä¸bçš„ç¬¦å·ã€‘
        {
            id: "A-02", type: "main",
            question: "æŠ›ç‰©çº¿ $ y = -(x+2)^2 + 3 $ çš„å¯¹ç§°è½´æ˜¯ï¼Ÿ",
            options: ["ç›´çº¿ $x=2$", "ç›´çº¿ $x=-2$", "ç›´çº¿ $x=3$", "ç›´çº¿ $x=-3$"],
            correct: 1, 
            remediation: {
                explanation: "é¡¶ç‚¹å¼ $y=a(x-h)^2+k$ çš„å¯¹ç§°è½´æ˜¯ç›´çº¿ $x=h$ã€‚<br>è¿™é‡Œæ‹¬å·å†…æ˜¯ $x+2$ï¼Œå³ $x-(-2)$ï¼Œæ‰€ä»¥ $h=-2$ã€‚å¯¹ç§°è½´æ˜¯ $x=-2$ã€‚",
                variant: {
                    question: "å·²çŸ¥ $y=ax^2+bx+c$ çš„å¯¹ç§°è½´æ˜¯ç›´çº¿ $x=1$ï¼Œä¸” $a>0$ï¼Œåˆ™ $b$ çš„ç¬¦å·æ˜¯ï¼Ÿ",
                    options: ["$b>0$", "$b<0$", "$b=0$", "æ— æ³•ç¡®å®š"],
                    correct: 1
                },
                stepByStep: [
                    "ç¬¬ä¸€æ­¥ï¼šå¯¹ç§°è½´å…¬å¼ $x = -\\frac{b}{2a} = 1$ã€‚",
                    "ç¬¬äºŒæ­¥ï¼šå› ä¸ºå¯¹ç§°è½´åœ¨yè½´å³ä¾§(æ­£)ï¼Œæ ¹æ®â€œå·¦åŒå³å¼‚â€ï¼Œ$a,b$ å¿…é¡»å¼‚å·ã€‚",
                    "ç¬¬ä¸‰æ­¥ï¼šå·²çŸ¥ $a>0$ (æ­£)ï¼Œæ‰€ä»¥ $b$ å¿…é¡»æ˜¯è´Ÿçš„ã€‚"
                ]
            }
        },
        // ã€A-03 å›¾åƒå¹³ç§»ã€‘
        {
            id: "A-03", type: "main",
            question: "å°†æŠ›ç‰©çº¿ $ y=2x^2 $ å‘å·¦å¹³ç§» 1 ä¸ªå•ä½ï¼Œå†å‘ä¸‹å¹³ç§» 3 ä¸ªå•ä½ï¼Œè§£æå¼ä¸ºï¼Ÿ",
            options: ["$ y=2(x-1)^2-3 $", "$ y=2(x+1)^2-3 $", "$ y=2(x-1)^2+3 $", "$ y=2(x+1)^2+3 $"],
            correct: 1, 
            remediation: {
                explanation: "<strong>å¹³ç§»å£è¯€ï¼š</strong>å·¦åŠ å³å‡ï¼ˆæ‹¬å·å†…ï¼‰ï¼Œä¸ŠåŠ ä¸‹å‡ï¼ˆæ‹¬å·å¤–ï¼‰ã€‚<br>å·¦ç§»1 $\\rightarrow$ $x$ å˜ $(x+1)$ï¼›ä¸‹ç§»3 $\\rightarrow$ å°¾å·´å‡3ã€‚",
                variant: {
                    question: "æŠ›ç‰©çº¿ $ y=(x-2)^2+1 $ æ˜¯ç”± $y=x^2$ æ€æ ·å¹³ç§»å¾—åˆ°çš„ï¼Ÿ",
                    options: ["å³ç§»2ï¼Œä¸Šç§»1", "å·¦ç§»2ï¼Œä¸Šç§»1", "å³ç§»2ï¼Œä¸‹ç§»1", "å·¦ç§»2ï¼Œä¸‹ç§»1"],
                    correct: 0
                },
                stepByStep: [
                    "ç¬¬ä¸€æ­¥ï¼šçœ‹æ‹¬å·å†… $(x-2)$ï¼Œè¿™æ˜¯å‡å·ï¼Œå¯¹åº”â€œå³å‡â€ï¼Œæ‰€ä»¥æ˜¯å‘å³å¹³ç§»2ã€‚",
                    "ç¬¬äºŒæ­¥ï¼šçœ‹æ‹¬å·å¤– $+1$ï¼Œè¿™æ˜¯åŠ å·ï¼Œå¯¹åº”â€œä¸ŠåŠ â€ï¼Œæ‰€ä»¥æ˜¯å‘ä¸Šå¹³ç§»1ã€‚",
                    "ç¬¬ä¸‰æ­¥ï¼šç»¼åˆå¾—â€œå³ç§»2ï¼Œä¸Šç§»1â€ã€‚"
                ]
            }
        },
        // ã€A-04 äº¤ç‚¹ä¸åˆ¤åˆ«å¼ã€‘
        {
            id: "A-04", type: "main",
            question: "æŠ›ç‰©çº¿ $ y=x^2-2x+3 $ ä¸ $x$ è½´çš„äº¤ç‚¹ä¸ªæ•°æ˜¯ï¼Ÿ",
            options: ["0ä¸ª", "1ä¸ª", "2ä¸ª", "3ä¸ª"],
            correct: 0, 
            remediation: {
                explanation: "äº¤ç‚¹ä¸ªæ•°çœ‹ $\\Delta = b^2-4ac$ã€‚<br>è¿™é‡Œ $a=1, b=-2, c=3$ã€‚<br>$\\Delta = (-2)^2 - 4\\times1\\times3 = 4 - 12 = -8$ã€‚<br>$\\Delta < 0$ï¼Œæ‰€ä»¥æ— äº¤ç‚¹ã€‚",
                variant: {
                    question: "è‹¥æŠ›ç‰©çº¿ $ y=x^2+4x+k $ ä¸ $x$ è½´åªæœ‰ä¸€ä¸ªäº¤ç‚¹ï¼Œåˆ™ $k=$ï¼Ÿ",
                    options: ["4", "-4", "2", "0"],
                    correct: 0
                },
                stepByStep: [
                    "ç¬¬ä¸€æ­¥ï¼šåªæœ‰ä¸€ä¸ªäº¤ç‚¹æ„å‘³ç€ $\\Delta = 0$ã€‚",
                    "ç¬¬äºŒæ­¥ï¼šåˆ—å¼ $\\Delta = 4^2 - 4\\times1\\times k = 0$ã€‚",
                    "ç¬¬ä¸‰æ­¥ï¼š$16 - 4k = 0 \\Rightarrow 4k = 16 \\Rightarrow k=4$ã€‚"
                ]
            }
        },
        // ã€A-05 è¯†å›¾ç»¼åˆé¢˜ (ç»å…¸ä¸­è€ƒé¢˜)ã€‘
        {
            id: "A-05", type: "main",
            question: "å¦‚å›¾ï¼ŒæŠ›ç‰©çº¿å¼€å£å‘ä¸‹ï¼Œé¡¶ç‚¹åœ¨ç¬¬ä¸€è±¡é™ï¼Œä¸yè½´äº¤äºæ­£åŠè½´ã€‚åˆ™ $a,b,c$ ç¬¦å·ä¸ºï¼Ÿ",
            options: ["$a<0, b>0, c>0$", "$a<0, b<0, c>0$", "$a<0, b>0, c<0$", "$a>0, b>0, c>0$"],
            correct: 0, 
            remediation: {
                explanation: "1. å¼€å£å‘ä¸‹ $\\rightarrow a<0$ï¼›<br>2. é¡¶ç‚¹åœ¨ç¬¬ä¸€è±¡é™(å³ä¾§) $\\rightarrow$ å¯¹ç§°è½´ $>0$ $\\rightarrow$ å·¦åŒå³å¼‚ $\\rightarrow b$ä¸$a$å¼‚å· $\\rightarrow b>0$ï¼›<br>3. äº¤yè½´æ­£åŠè½´ $\\rightarrow c>0$ã€‚",
                variant: {
                    question: "è‹¥ $y=ax^2+bx+c$ çš„å›¾åƒå¦‚å›¾æ‰€ç¤ºï¼š$a<0$ï¼Œ$b<0$ï¼Œåˆ™å¯¹ç§°è½´åœ¨ï¼Ÿ",
                    options: ["yè½´å·¦ä¾§", "yè½´å³ä¾§", "yè½´ä¸Š", "æ— æ³•ç¡®å®š"],
                    correct: 0
                },
                stepByStep: [
                    "ç¬¬ä¸€æ­¥ï¼šå£è¯€â€œå·¦åŒå³å¼‚â€ã€‚",
                    "ç¬¬äºŒæ­¥ï¼šç°åœ¨ $a$ æ˜¯è´Ÿï¼Œ$b$ æ˜¯è´Ÿï¼Œå®ƒä»¬ç¬¦å·â€œç›¸åŒâ€ã€‚",
                    "ç¬¬ä¸‰æ­¥ï¼šåŒå·åœ¨å·¦ï¼Œæ‰€ä»¥å¯¹ç§°è½´åœ¨yè½´å·¦ä¾§ã€‚"
                ]
            }
        },
        // ã€A-06 å¢å‡æ€§ã€‘
        {
            id: "A-06", type: "main",
            question: "æŠ›ç‰©çº¿ $ y=(x-1)^2+2 $ï¼Œå½“ $x>1$ æ—¶ï¼Œyéšxçš„å¢å¤§è€Œï¼Ÿ",
            options: ["å¢å¤§", "å‡å°", "å…ˆå¢åå‡", "å…ˆå‡åå¢"],
            correct: 0, 
            remediation: {
                explanation: "1. æ‰¾å¯¹ç§°è½´ï¼š$x=1$ã€‚<br>2. çœ‹å¼€å£ï¼š$a=1>0$ï¼Œå¼€å£å‘ä¸Šã€‚<br>3. ç”»è‰å›¾ï¼šå¯¹ç§°è½´å³ä¾§($x>1$) å›¾åƒæ˜¯ä¸Šå‡çš„ã€‚<br>æ‰€ä»¥yéšxå¢å¤§è€Œå¢å¤§ã€‚",
                variant: {
                    question: "æŠ›ç‰©çº¿ $ y=-x^2 $ï¼Œå½“ $x<0$ æ—¶ï¼Œyéšxçš„å¢å¤§è€Œï¼Ÿ",
                    options: ["å¢å¤§", "å‡å°", "ä¸å˜", "æ— æ³•ç¡®å®š"],
                    correct: 0
                },
                stepByStep: [
                    "ç¬¬ä¸€æ­¥ï¼šå¯¹ç§°è½´æ˜¯ $x=0$ (yè½´)ï¼Œå¼€å£å‘ä¸‹ ($a=-1$)ã€‚",
                    "ç¬¬äºŒæ­¥ï¼šæƒ³è±¡ä¸€ä¸ªå“­è„¸ã€‚åœ¨yè½´å·¦ä¾§ ($x<0$)ï¼Œå›¾åƒæ˜¯çˆ¬å¡è¿˜æ˜¯ä¸‹å¡ï¼Ÿ",
                    "ç¬¬ä¸‰æ­¥ï¼šä»å·¦å¾€å³çœ‹ï¼Œå›¾åƒæ˜¯ä¸Šå‡çš„ï¼ˆçˆ¬å¡ï¼‰ï¼Œæ‰€ä»¥æ˜¯â€œå¢å¤§â€ã€‚"
                ]
            }
        }
    ];

    // ================= é€»è¾‘æ§åˆ¶ (ä¸Sçº§å®Œå…¨ä¸€è‡´) =================
    let userAnswers = [];
    let wrongIndices = [];
    let currentQuizIndex = 0;
    let currentRemedyIndex = 0;
    let criticalFailures = 0;

    function startQuiz() {
        switchScene('scene-quiz');
        loadQuizQuestion();
    }

    function loadQuizQuestion() {
        const q = questionBank[currentQuizIndex];
        document.getElementById('quiz-progress-text').innerText = `${currentQuizIndex + 1} / ${questionBank.length}`;
        document.getElementById('quiz-progress-fill').style.width = `${((currentQuizIndex+1)/questionBank.length)*100}%`;
        document.getElementById('quiz-question-text').innerHTML = q.question;
        const container = document.getElementById('quiz-options-container');
        container.innerHTML = '';
        q.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'btn btn-opt';
            btn.innerHTML = opt;
            btn.onclick = () => selectQuizOption(idx, btn);
            container.appendChild(btn);
        });
        document.getElementById('quiz-next-btn').style.display = 'none';
        renderMath();
    }

    function selectQuizOption(idx, btn) {
        document.querySelectorAll('#quiz-options-container .btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        userAnswers[currentQuizIndex] = idx;
        const nextBtn = document.getElementById('quiz-next-btn');
        nextBtn.style.display = 'block';
        if (currentQuizIndex === questionBank.length - 1) {
            nextBtn.innerText = "æäº¤è¯•å·";
            nextBtn.onclick = submitQuiz;
        } else {
            nextBtn.innerText = "ä¸‹ä¸€é¢˜";
            nextBtn.onclick = () => { currentQuizIndex++; loadQuizQuestion(); };
        }
    }

    function submitQuiz() {
        wrongIndices = [];
        questionBank.forEach((q, idx) => {
            if (userAnswers[idx] !== q.correct) wrongIndices.push(idx);
        });
        if (wrongIndices.length === 0) showResult(true);
        else {
            alert(`è¯Šæ–­å‡º ${wrongIndices.length} ä¸ªå›¾åƒç†è§£è¯¯åŒºï¼Œè¿›å…¥æ™ºèƒ½ä¿®å¤ã€‚`);
            startRemediation();
        }
    }

    function startRemediation() {
        currentRemedyIndex = 0;
        criticalFailures = 0;
        switchScene('scene-remedy');
        loadRemedyItem();
    }

    function loadRemedyItem() {
        const idx = wrongIndices[currentRemedyIndex];
        const data = questionBank[idx];
        document.getElementById('remedy-original-question').innerHTML = data.question;
        document.getElementById('remedy-explanation').innerHTML = data.remediation.explanation;
        document.getElementById('variant-question-text').innerHTML = data.remediation.variant.question;
        document.getElementById('deep-dive-box').style.display = 'none';
        document.getElementById('remedy-next-btn').style.display = 'none';
        document.getElementById('variant-feedback').innerHTML = '';
        renderVariantOptions(data, false);
        renderMath();
    }

    function renderVariantOptions(data, isRetry) {
        const container = document.getElementById('variant-options-container');
        container.innerHTML = '';
        data.remediation.variant.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'btn btn-opt';
            btn.innerHTML = opt;
            btn.onclick = () => checkVariantAnswer(idx, btn, data, isRetry);
            container.appendChild(btn);
        });
        renderMath();
    }

    function checkVariantAnswer(userIdx, btn, data, isRetry) {
        const correctIdx = data.remediation.variant.correct;
        const allBtns = document.querySelectorAll('#variant-options-container .btn');
        allBtns.forEach(b => b.classList.add('disabled'));

        if (userIdx === correctIdx) {
            btn.style.backgroundColor = '#dcedc8'; btn.style.borderColor = '#00796b';
            document.getElementById('variant-feedback').innerHTML = '<span style="color:green">âœ… å›¾åƒæ€ç»´å·²ä¿®å¤ï¼</span>';
            document.getElementById('remedy-next-btn').style.display = 'inline-block';
        } else {
            btn.style.backgroundColor = '#ffcdd2'; btn.style.borderColor = '#c62828';
            if (!isRetry) {
                document.getElementById('variant-feedback').innerHTML = '<span style="color:#c62828">âŒ è¿˜æ˜¯æ²¡çœ‹æ‡‚å›¾ï¼Ÿè¯·çœ‹ä¸‹æ–¹çš„ã€åˆ†æ­¥æ‹†è§£ã€‘ã€‚ğŸ‘‡</span>';
                showDeepDive(data);
            } else {
                criticalFailures++;
                allBtns[correctIdx].style.backgroundColor = '#dcedc8';
                document.getElementById('variant-feedback').innerHTML = '<span style="color:red">ğŸ†˜ æ­¤çŸ¥è¯†ç‚¹éœ€è¦è€å¸ˆå½“é¢ç”»å›¾è®²è§£ã€‚</span>';
                document.getElementById('remedy-next-btn').style.display = 'inline-block';
            }
        }
    }

    function showDeepDive(data) {
        const box = document.getElementById('deep-dive-box');
        const stepsDiv = document.getElementById('deep-steps');
        stepsDiv.innerHTML = '';
        data.remediation.stepByStep.forEach(step => {
            const div = document.createElement('div');
            div.className = 'step-item';
            div.innerHTML = step;
            stepsDiv.appendChild(div);
        });
        box.style.display = 'block';
        renderMath();
        box.scrollIntoView({behavior: "smooth"});
    }

    function retryVariant() {
        const idx = wrongIndices[currentRemedyIndex];
        const data = questionBank[idx];
        document.getElementById('deep-dive-box').style.display = 'none';
        document.getElementById('variant-feedback').innerHTML = '';
        renderVariantOptions(data, true);
    }

    function nextRemedyItem() {
        currentRemedyIndex++;
        if (currentRemedyIndex < wrongIndices.length) loadRemedyItem();
        else showResult(false);
    }

    function showResult(isPerfect) {
        switchScene('scene-result');
        const div = document.getElementById('result-details');
        if (isPerfect) {
            div.innerHTML = "<h3 style='color:green'>Açº§æŒ‘æˆ˜æˆåŠŸï¼ğŸ‰</h3><p>ä½ çš„â€œæ•°å½¢ç»“åˆâ€èƒ½åŠ›éå¸¸å‡ºè‰²ï¼</p>";
        } else {
            let html = `<p>åˆæµ‹å¾—åˆ†ï¼š${questionBank.length - wrongIndices.length} / ${questionBank.length}</p>`;
            html += `<p>ä¿®å¤äº† ${wrongIndices.length} ä¸ªè®¤çŸ¥æ¼æ´ã€‚</p>`;
            if (criticalFailures > 0) {
                html += `<div style="background:#ffebee; padding:10px; border-left:4px solid red; margin-top:10px;"><strong>ğŸš¨ æ³¨æ„ï¼š</strong> æœ‰ ${criticalFailures} ä¸ªé—®é¢˜ä¾ç„¶æœªè§£å†³ï¼Œå»ºè®®é‡ç”»è‰å›¾å¤ä¹ ã€‚</div>`;
            } else {
                html += `<div style="background:#e8f5e9; padding:10px; border-left:4px solid green; margin-top:10px;">âœ… æ‰€æœ‰æ¼æ´å·²ä¿®å¤ã€‚</div>`;
            }
            div.innerHTML = html;
        }
    }

    function switchScene(id) {
        document.querySelectorAll('.scene').forEach(e => e.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0, 0);
    }
    
    function renderMath() {
        if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) MathJax.typesetPromise();
    }
</script>

</body>
</html>
