<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bçº§ç‰¹è®­ï¼šä¸‰ä¸ªâ€œäºŒæ¬¡â€çš„å…³ç³»</title>
    
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true
            },
            startup: {
                pageReady: () => {
                    return MathJax.startup.defaultPageReady();
                }
            }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.bootcdn.net/ajax/libs/mathjax/3.2.2/es5/tex-chtml.min.js"></script>

    <style>
        :root {
            --primary: #00695c; /* Bçº§ä½¿ç”¨è“ç»¿è‰²ï¼Œä»£è¡¨é€»è¾‘ä¸è¿æ¥ */
            --quiz: #1565c0;    /* æµ‹è¯•åŒºè“è‰² */
            --remedy: #ff6f00;  /* è¡¥æ•‘æ©™ */
            --deep: #b71c1c;    /* æ·±åº¦çº¢ */
            --bg: #e0f2f1;      /* æµ…é’èƒŒæ™¯ */
            --card: #ffffff;
        }

        body { font-family: 'Segoe UI', 'PingFang SC', sans-serif; background: var(--bg); margin: 0; padding: 20px; line-height: 1.6; color: #333; }
        .container { max-width: 800px; margin: 0 auto; }
        
        /* åœºæ™¯åˆ‡æ¢ */
        .scene { display: none; animation: fadeIn 0.5s; }
        .scene.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* å¡ç‰‡æ ·å¼ */
        .card { background: var(--card); padding: 30px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 20px; }
        
        h1, h2, h3 { margin-top: 0; color: #263238; }
        
        /* æŒ‰é’® */
        .btn {
            display: inline-block; padding: 12px 24px; border-radius: 6px; cursor: pointer; border: none; font-size: 1rem; color: white; transition: 0.2s;
            width: 100%; text-align: left; margin-bottom: 10px;
        }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-primary { background: var(--primary); text-align: center; font-weight: bold; width: auto; }
        
        .btn-opt { background: white; color: #333; border: 2px solid #e0e0e0; }
        .btn-opt:hover { background: #b2dfdb; border-color: var(--primary); }
        .btn-opt.selected { background: #b2dfdb; border-color: var(--primary); color: var(--primary); font-weight: bold; }
        .disabled { pointer-events: none; opacity: 0.6; }

        /* Phase 1 æ•™å­¦åŒº */
        .study-header { border-left: 5px solid var(--primary); padding-left: 15px; margin-bottom: 20px; }
        .knowledge-point { background: #f1f8e9; border: 1px dashed var(--primary); padding: 15px; border-radius: 8px; margin-bottom: 15px; }
        .key-tag { background: var(--primary); color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; margin-right: 5px; }

        /* SVG å›¾ç¤ºæ¡† */
        .svg-demo { text-align: center; margin: 10px 0; background: white; border-radius: 8px; padding: 10px; border: 1px solid #ddd; }

        /* Phase 3 è¡¥æ•‘åŒº */
        .remedy-header { background: #fff8e1; color: #ff6f00; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #ffe0b2; }
        .deep-dive-box {
            display: none; background: #ffebee; border: 2px dashed var(--deep); padding: 15px; border-radius: 8px; margin-top: 15px; animation: slideDown 0.5s;
        }
        @keyframes slideDown { from { opacity:0; transform:translateY(-10px); } to { opacity:1; transform:translateY(0); } }
        .step-item { margin-bottom: 8px; padding-left: 10px; border-left: 3px solid var(--deep); }

        /* è¿›åº¦æ¡ */
        .progress-bar { height: 8px; background: #e0e0e0; border-radius: 4px; margin-bottom: 20px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--quiz); width: 0%; transition: width 0.3s; }
    </style>
</head>
<body>

<div class="container">

    <div id="scene-study" class="scene active">
        <div class="card">
            <div class="study-header">
                <h1>Bçº§ï¼šæ‰“é€šä»»ç£äºŒè„‰</h1>
                <p>è¿™ä¸€å…³çš„ç›®æ ‡æ˜¯æ‰“é€šâ€œå‡½æ•°ã€æ–¹ç¨‹ã€ä¸ç­‰å¼â€çš„å£å’ã€‚å®ƒä»¬æœ¬è´¨ä¸Šæ˜¯ä¸€å›äº‹ï¼</p>
            </div>
            
            <div class="knowledge-point">
                <h3><span class="key-tag">å…³ç³»1</span>å‡½æ•° vs æ–¹ç¨‹</h3>
                <p><strong>å›¾åƒä¸ x è½´çš„äº¤ç‚¹ $\Leftrightarrow$ æ–¹ç¨‹çš„æ ¹</strong></p>
                <ul>
                    <li>å‡½æ•° $y=ax^2+bx+c$ ä¸ x è½´äº¤ç‚¹æ¨ªåæ ‡ä¸º $x_1, x_2$ã€‚</li>
                    <li>å¯¹åº”æ–¹ç¨‹ $ax^2+bx+c=0$ çš„æ ¹å°±æ˜¯ $x_1, x_2$ã€‚</li>
                </ul>
                <div class="svg-demo">
                    <svg width="200" height="80" viewBox="-100 -40 200 80">
                        <line x1="-90" y1="20" x2="90" y2="20" stroke="#333" stroke-width="1"/>
                        <path d="M -50 -30 Q 0 80 50 -30" stroke="#00695c" stroke-width="2" fill="none"/>
                        <circle cx="-35" cy="20" r="3" fill="red"/><text x="-45" y="40" font-size="10" fill="red">x1</text>
                        <circle cx="35" cy="20" r="3" fill="red"/><text x="30" y="40" font-size="10" fill="red">x2</text>
                        <text x="-90" y="10" font-size="10">y=0 (xè½´)</text>
                    </svg>
                </div>
            </div>

            <div class="knowledge-point">
                <h3><span class="key-tag">å…³ç³»2</span>å‡½æ•° vs ä¸ç­‰å¼</h3>
                <p><strong>å›¾åƒçš„é«˜ä½ $\Leftrightarrow$ ä¸ç­‰å¼çš„è§£é›†</strong></p>
                <ul>
                    <li>è§£ $ax^2+bx+c > 0$ $\rightarrow$ æ‰¾å›¾åƒåœ¨ x è½´ <strong>ä¸Šæ–¹</strong> çš„éƒ¨åˆ†ã€‚</li>
                    <li>è§£ $ax^2+bx+c < 0$ $\rightarrow$ æ‰¾å›¾åƒåœ¨ x è½´ <strong>ä¸‹æ–¹</strong> çš„éƒ¨åˆ†ã€‚</li>
                </ul>
            </div>

            <div class="knowledge-point">
                <h3><span class="key-tag">å…³ç³»3</span>ä¸¤å‡½æ•°äº¤ç‚¹</h3>
                <p>æ±‚ç›´çº¿ $y=kx+m$ ä¸æŠ›ç‰©çº¿ $y=ax^2...$ çš„äº¤ç‚¹ï¼š</p>
                <ul>
                    <li><strong>æ–¹æ³•ï¼š</strong> è”ç«‹æ–¹ç¨‹ç»„ $\rightarrow$ æ¶ˆå» y $\rightarrow$ è§£æ–°çš„ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹ã€‚</li>
                    <li>äº¤ç‚¹ä¸ªæ•°ç”±æ–°æ–¹ç¨‹çš„ $\Delta$ å†³å®šã€‚</li>
                </ul>
            </div>

            <button class="btn btn-primary" style="width:100%; margin-top:20px;" onclick="startQuiz()">æˆ‘ç†è§£äº†é€»è¾‘ï¼Œå¼€å§‹æµ‹è¯• â¡</button>
        </div>
    </div>

    <div id="scene-quiz" class="scene">
        <div class="card">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <span style="font-weight:bold; color:var(--quiz);">Bçº§ è´¯é€šæµ‹è¯•</span>
                <span id="quiz-progress-text">1 / 6</span>
            </div>
            <div class="progress-bar"><div class="progress-fill" id="quiz-progress-fill"></div></div>

            <h3 id="quiz-question-text">...</h3>
            <div id="quiz-options-container"></div>
            <button id="quiz-next-btn" class="btn btn-primary" style="margin-top:20px; display:none;">ä¸‹ä¸€é¢˜</button>
        </div>
    </div>

    <div id="scene-remedy" class="scene">
        <div class="card" style="border-top: 5px solid var(--remedy);">
            <div class="remedy-header">
                <h3>âš ï¸ é€»è¾‘æ–­ç‚¹è¯Šæ–­</h3>
                <p>ä½ åœ¨è½¬æ¢â€œå‡½æ•°/æ–¹ç¨‹/ä¸ç­‰å¼â€æ—¶å¡ä½äº†ï¼Œè®©æˆ‘ä»¬é‡æ–°è¿æ¥é€»è¾‘ã€‚</p>
            </div>

            <div style="margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:15px;">
                <p><strong>âŒ åŸé¢˜å›é¡¾ï¼š</strong> <span id="remedy-original-question">...</span></p>
                <div style="background:#fff3e0; padding:15px; border-radius:8px; color:#555;">
                    <strong>ğŸ“– é€»è¾‘è§£æï¼š</strong> <span id="remedy-explanation">...</span>
                </div>
            </div>

            <h4 style="color:var(--remedy);">âœï¸ å˜å¼æŒ‘æˆ˜ï¼š</h4>
            <p id="variant-question-text" style="font-weight:bold;">...</p>
            <div id="variant-options-container"></div>
            
            <div id="deep-dive-box" class="deep-dive-box">
                <h4 style="color:var(--deep); margin-top:0;">ğŸš¨ ä¾ç„¶åšé”™ï¼Ÿå¯åŠ¨ã€åˆ†æ­¥æ‹†è§£ã€‘</h4>
                <div id="deep-steps"></div>
                <div style="margin-top:15px; text-align:right;">
                    <button class="btn btn-primary" style="background:var(--deep); width:auto;" onclick="retryVariant()">ğŸ”„ é‡åšæ­¤é¢˜</button>
                </div>
            </div>

            <div id="variant-feedback" style="margin-top:15px; font-weight:bold; min-height:30px;"></div>
            <button id="remedy-next-btn" class="btn btn-primary" style="margin-top:20px; display:none;" onclick="nextRemedyItem()">ä¸‹ä¸€é¡¹è¯Šæ–­ â¡</button>
        </div>
    </div>

    <div id="scene-result" class="scene">
        <div class="card" style="text-align: center;">
            <div style="font-size: 4em; margin-bottom: 10px;">ğŸ”—</div>
            <h2>Bçº§ ç‰¹è®­å®Œæˆ</h2>
            <div id="result-details" style="text-align: left; margin: 20px 0; background: #f5f5f5; padding: 20px; border-radius: 8px;"></div>
            <button class="btn btn-primary" onclick="location.reload()">å†æ¥ä¸€æ¬¡</button>
        </div>
    </div>

</div>

<script>
    // =========================================================
    // Bçº§æ ¸å¿ƒé¢˜åº“ï¼šä¸‰ä¸ªäºŒæ¬¡çš„å…³ç³»
    // =========================================================
    const questionBank = [
        // ã€B-01ã€‘å‡½æ•°ä¸æ–¹ç¨‹ï¼šæ ¹ä¸äº¤ç‚¹
        {
            id: "B-01", type: "main",
            question: "å·²çŸ¥æ–¹ç¨‹ $x^2-3x-4=0$ çš„ä¸¤æ ¹ä¸º $x_1=-1, x_2=4$ã€‚åˆ™æŠ›ç‰©çº¿ $y=x^2-3x-4$ ä¸ $x$ è½´çš„äº¤ç‚¹åæ ‡æ˜¯ï¼Ÿ",
            options: ["$(-1,0)$ å’Œ $(4,0)$", "$(1,0)$ å’Œ $(-4,0)$", "$(0,-1)$ å’Œ $(0,4)$", "$(0,1)$ å’Œ $(0,-4)$"],
            correct: 0, 
            remediation: {
                explanation: "<strong>é€»è¾‘æ¡¥æ¢ï¼š</strong>æ–¹ç¨‹çš„æ ¹ $\\Leftrightarrow$ å‡½æ•°å›¾åƒä¸ x è½´äº¤ç‚¹çš„æ¨ªåæ ‡ã€‚<br>æ ¹æ˜¯ $-1$ å’Œ $4$ï¼Œå¯¹åº”çš„ç‚¹å°±æ˜¯ $(-1, 0)$ å’Œ $(4, 0)$ã€‚",
                variant: {
                    question: "è‹¥æŠ›ç‰©çº¿ $y=x^2-5x+6$ ä¸ $x$ è½´äº¤äº $(2,0)$ å’Œ $(3,0)$ï¼Œåˆ™æ–¹ç¨‹ $x^2-5x+6=0$ çš„è§£æ˜¯ï¼Ÿ",
                    options: ["$x=2, x=3$", "$x=-2, x=-3$", "$x=2, x=-3$", "$x=-2, x=3$"],
                    correct: 0
                },
                stepByStep: [
                    "ç¬¬ä¸€æ­¥ï¼šç†è§£é¢˜æ„ã€‚é¢˜ç›®ç»™çš„æ˜¯â€œå›¾åƒäº¤ç‚¹â€ã€‚",
                    "ç¬¬äºŒæ­¥ï¼šé€»è¾‘è½¬æ¢ã€‚å›¾åƒäº¤ç‚¹çš„æ¨ªåæ ‡ $x$ï¼Œå°±æ˜¯å¯¹åº”æ–¹ç¨‹çš„æ ¹ã€‚",
                    "ç¬¬ä¸‰æ­¥ï¼šäº¤ç‚¹æ¨ªåæ ‡æ˜¯ 2 å’Œ 3ï¼Œæ‰€ä»¥æ–¹ç¨‹çš„è§£å°±æ˜¯ $x_1=2, x_2=3$ã€‚"
                ]
            }
        },
        // ã€B-02ã€‘å‡½æ•°ä¸ä¸ç­‰å¼ï¼šçœ‹å›¾è§£é›† (ä¸Š)
        {
            id: "B-02", type: "main",
            question: " å¦‚å›¾ï¼ŒæŠ›ç‰©çº¿ä¸xè½´äº¤äº $(-1,0)$ å’Œ $(3,0)$ã€‚å½“ $y < 0$ æ—¶ï¼Œxçš„å–å€¼èŒƒå›´æ˜¯ï¼Ÿ",
            options: ["$x < -1$ æˆ– $x > 3$", "$-1 < x < 3$", "$x > 3$", "$x < -1$"],
            correct: 1, 
            remediation: {
                explanation: "1. $y < 0$ æ„å‘³ç€å›¾åƒåœ¨ x è½´<strong>ä¸‹æ–¹</strong>ã€‚<br>2. è§‚å¯Ÿå›¾åƒï¼Œåœ¨ $-1$ å’Œ $3$ ä¹‹é—´çš„é‚£æ®µå›¾åƒæ˜¯â€œå‡¹â€ä¸‹å»åœ¨æ°´é¢ä¸‹çš„ã€‚<br>3. æ‰€ä»¥èŒƒå›´æ˜¯ä¸­é—´æ®µï¼š$-1 < x < 3$ã€‚",
                variant: {
                    question: "è‹¥æŠ›ç‰©çº¿å¼€å£å‘ä¸Šï¼Œäº¤ç‚¹ä¸º $-2$ å’Œ $4$ã€‚åˆ™ $y > 0$ (åœ¨ä¸Šæ–¹) çš„è§£é›†æ˜¯ï¼Ÿ",
                    options: ["$-2 < x < 4$", "$x < -2$ æˆ– $x > 4$", "$x > 4$", "$x < -2$"],
                    correct: 1
                },
                stepByStep: [
                    "ç¬¬ä¸€æ­¥ï¼šç”»è‰å›¾ã€‚å¼€å£å‘ä¸Šï¼Œäº¤ç‚¹ -2, 4ã€‚",
                    "ç¬¬äºŒæ­¥ï¼šæ‰¾åŒºåŸŸã€‚$y>0$ æ„å‘³ç€è¦åœ¨ x è½´ä¸Šæ–¹ï¼ˆä¸¤åªè€³æœµï¼‰ã€‚",
                    "ç¬¬ä¸‰æ­¥ï¼šçœ‹xè½´ã€‚ä¸¤è¾¹çš„éƒ¨åˆ†åœ¨ä¸Šæ–¹ï¼Œæ‰€ä»¥æ˜¯ $x < -2$ æˆ–è€… $x > 4$ã€‚"
                ]
            }
        },
        // ã€B-03ã€‘ç›´çº¿ä¸æŠ›ç‰©çº¿çš„äº¤ç‚¹
        {
            id: "B-03", type: "main",
            question: "æ±‚ç›´çº¿ $y=2x$ ä¸æŠ›ç‰©çº¿ $y=x^2$ çš„äº¤ç‚¹ä¸ªæ•°ï¼Ÿ",
            options: ["0ä¸ª", "1ä¸ª", "2ä¸ª", "3ä¸ª"],
            correct: 2, 
            remediation: {
                explanation: "<strong>è”ç«‹æ–¹ç¨‹ï¼š</strong>ä»¤ $x^2 = 2x$ã€‚<br>ç§»é¡¹å¾— $x^2 - 2x = 0$ã€‚<br>è§£å¾— $x_1=0, x_2=2$ã€‚æœ‰ä¸¤ä¸ªä¸åŒçš„è§£ï¼Œæ‰€ä»¥æœ‰ 2 ä¸ªäº¤ç‚¹ã€‚",
                variant: {
                    question: "ç›´çº¿ $y=x-2$ ä¸æŠ›ç‰©çº¿ $y=x^2$ æœ‰å‡ ä¸ªäº¤ç‚¹ï¼Ÿ",
                    options: ["0ä¸ª", "1ä¸ª", "2ä¸ª", "æ— æ³•ç¡®å®š"],
                    correct: 0
                },
                stepByStep: [
                    "ç¬¬ä¸€æ­¥ï¼šè”ç«‹ã€‚ä»¤ $x^2 = x - 2$ã€‚",
                    "ç¬¬äºŒæ­¥ï¼šæ•´ç†æˆä¸€èˆ¬å¼ã€‚$x^2 - x + 2 = 0$ã€‚",
                    "ç¬¬ä¸‰æ­¥ï¼šç®—åˆ¤åˆ«å¼ $\\Delta$ã€‚$\\Delta = (-1)^2 - 4\\times1\\times2 = 1-8 = -7 < 0$ã€‚æ— è§£ï¼Œæ‰€ä»¥0ä¸ªäº¤ç‚¹ã€‚"
                ]
            }
        },
        // ã€B-04ã€‘åˆ©ç”¨å¯¹ç§°æ€§æ±‚æ ¹
        {
            id: "B-04", type: "main",
            question: "å·²çŸ¥æŠ›ç‰©çº¿ $y=ax^2+bx+c$ çš„å¯¹ç§°è½´æ˜¯ $x=1$ï¼Œå…¶ä¸­ä¸€ä¸ªä¸xè½´äº¤ç‚¹æ˜¯ $(3,0)$ï¼Œå¦ä¸€ä¸ªäº¤ç‚¹æ˜¯ï¼Ÿ",
            options: ["$(-1,0)$", "$(-2,0)$", "$(-3,0)$", "$(0,0)$"],
            correct: 0, 
            remediation: {
                explanation: "<strong>å¯¹ç§°æ€§ï¼š</strong>ä¸¤ä¸ªäº¤ç‚¹å…³äºå¯¹ç§°è½´å¯¹ç§°ã€‚<br>ç‚¹ $3$ åˆ°å¯¹ç§°è½´ $1$ çš„è·ç¦»æ˜¯ $2$ã€‚<br>æ‰€ä»¥å¦ä¸€ä¸ªç‚¹åœ¨ $1$ å·¦è¾¹è·ç¦» $2$ çš„åœ°æ–¹ï¼š$1 - 2 = -1$ã€‚",
                variant: {
                    question: "æ–¹ç¨‹ $ax^2+bx+c=0$ çš„ä¸€æ ¹æ˜¯ $-2$ï¼Œå¯¹ç§°è½´æ˜¯ $x=0$ (yè½´)ï¼Œå¦ä¸€æ ¹æ˜¯ï¼Ÿ",
                    options: ["2", "0", "-4", "4"],
                    correct: 0
                },
                stepByStep: [
                    "ç¬¬ä¸€æ­¥ï¼šç”»æ•°è½´ã€‚æ ‡å‡ºå¯¹ç§°è½´ 0ï¼Œæ ‡å‡ºæ ¹ -2ã€‚",
                    "ç¬¬äºŒæ­¥ï¼šæ‰¾è·ç¦»ã€‚-2 åˆ° 0 çš„è·ç¦»æ˜¯ 2ã€‚",
                    "ç¬¬ä¸‰æ­¥ï¼šæ‰¾å¯¹ç§°ç‚¹ã€‚0 å³è¾¹è·ç¦» 2 çš„åœ°æ–¹ï¼Œå°±æ˜¯ 2ã€‚"
                ]
            }
        },
        // ã€B-05ã€‘éŸ¦è¾¾å®šç†åœ¨å‡½æ•°ä¸­çš„åº”ç”¨
        {
            id: "B-05", type: "main",
            question: "æŠ›ç‰©çº¿ $y=x^2+bx+3$ ä¸xè½´çš„ä¸¤ä¸ªäº¤ç‚¹æ¨ªåæ ‡ä¹‹ç§¯æ˜¯ï¼Ÿ",
            options: ["3", "-3", "b", "-b"],
            correct: 0, 
            remediation: {
                explanation: "äº¤ç‚¹æ¨ªåæ ‡å³æ–¹ç¨‹çš„æ ¹ã€‚<br>æ ¹æ®éŸ¦è¾¾å®šç†ï¼š$x_1 \cdot x_2 = \\frac{c}{a}$ã€‚<br>è¿™é‡Œ $c=3, a=1$ï¼Œæ‰€ä»¥ç§¯ä¸º $3/1 = 3$ã€‚",
                variant: {
                    question: "æŠ›ç‰©çº¿ $y=x^2-4x+5$ ä¸xè½´ä¸¤äº¤ç‚¹è®°ä¸º $A, B$ï¼Œåˆ™ $A, B$ çš„ä¸­ç‚¹åæ ‡çš„æ¨ªåæ ‡æ˜¯ï¼Ÿ",
                    options: ["4", "2", "-2", "-4"],
                    correct: 1
                },
                stepByStep: [
                    "ç¬¬ä¸€æ­¥ï¼šä¸¤äº¤ç‚¹ä¸­ç‚¹çš„æ¨ªåæ ‡ï¼Œå…¶å®å°±æ˜¯å¯¹ç§°è½´çš„ä½ç½®ã€‚",
                    "ç¬¬äºŒæ­¥ï¼šæˆ–è€…åˆ©ç”¨éŸ¦è¾¾å®šç† $(x_1+x_2)/2$ã€‚",
                    "ç¬¬ä¸‰æ­¥ï¼š$x_1+x_2 = -b/a = 4$ï¼Œé™¤ä»¥2å¾— 2ã€‚"
                ]
            }
        },
        // ã€B-06ã€‘çœ‹å›¾è§£ä¸ç­‰å¼ (å¤æ‚ç‰ˆ)
        {
            id: "B-06", type: "main",
            question: "å¦‚å›¾ï¼Œç›´çº¿ $y_1=x+1$ ä¸æŠ›ç‰©çº¿ $y_2=x^2$ äº¤äº $A(-0.6, 0.4)$ å’Œ $B(1.6, 2.6)$ (æ•°æ®ä»…ç¤ºæ„)ã€‚æ±‚ $x^2 > x+1$ çš„è§£é›†ï¼Ÿ",
            options: ["$x < -0.6$ æˆ– $x > 1.6$", "$-0.6 < x < 1.6$", "$x > 1.6$", "$x < -0.6$"],
            correct: 0, 
            remediation: {
                explanation: "è§£ $x^2 > x+1$ å³ $y_2 > y_1$ã€‚<br>ä¹Ÿå°±æ˜¯æ‰¾<strong>æŠ›ç‰©çº¿åœ¨ç›´çº¿ä¸Šæ–¹</strong>çš„éƒ¨åˆ†ã€‚<br>è§‚å¯Ÿäº¤ç‚¹ä¸¤ä¾§ï¼ŒæŠ›ç‰©çº¿é£å¾—æ¯”ç›´çº¿é«˜ï¼Œæ‰€ä»¥æ˜¯ä¸¤å¤´ï¼š$x < x_A$ æˆ– $x > x_B$ã€‚",
                variant: {
                    question: "è‹¥è¦æ±‚ $x^2 < x+1$ (æŠ›ç‰©çº¿åœ¨ç›´çº¿ä¸‹æ–¹) çš„èŒƒå›´ï¼Ÿ",
                    options: ["$-0.6 < x < 1.6$", "$x < -0.6$ æˆ– $x > 1.6$", "$x > 0$", "æ— è§£"],
                    correct: 0
                },
                stepByStep: [
                    "ç¬¬ä¸€æ­¥ï¼šç¿»è¯‘é¢˜ç›®ã€‚$x^2 < x+1$ æ„æ€æ˜¯â€œæŠ›ç‰©çº¿å‹åœ¨ç›´çº¿åº•ä¸‹â€ã€‚",
                    "ç¬¬äºŒæ­¥ï¼šçœ‹å›¾ã€‚åœ¨ä¸¤ä¸ªäº¤ç‚¹ä¹‹é—´ï¼ŒæŠ›ç‰©çº¿æ˜¯å‡¹ä¸‹å»çš„ï¼Œè¢«ç›´çº¿ç›–ä½äº†ã€‚",
                    "ç¬¬ä¸‰æ­¥ï¼šæ‰€ä»¥èŒƒå›´æ˜¯ä¸¤ä¸ªäº¤ç‚¹æ¨ªåæ ‡ä¹‹é—´ã€‚"
                ]
            }
        }
    ];

    // ================= é€»è¾‘æ§åˆ¶ (æ ‡å‡†ç‰ˆ) =================
    let userAnswers = [];
    let wrongIndices = [];
    let currentQuizIndex = 0;
    let currentRemedyIndex = 0;
    let criticalFailures = 0;

    function startQuiz() {
        switchScene('scene-quiz');
        loadQuizQuestion();
    }

    function loadQuizQuestion() {
        const q = questionBank[currentQuizIndex];
        document.getElementById('quiz-progress-text').innerText = `${currentQuizIndex + 1} / ${questionBank.length}`;
        document.getElementById('quiz-progress-fill').style.width = `${((currentQuizIndex+1)/questionBank.length)*100}%`;
        document.getElementById('quiz-question-text').innerHTML = q.question;
        const container = document.getElementById('quiz-options-container');
        container.innerHTML = '';
        q.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'btn btn-opt';
            btn.innerHTML = opt;
            btn.onclick = () => selectQuizOption(idx, btn);
            container.appendChild(btn);
        });
        document.getElementById('quiz-next-btn').style.display = 'none';
        renderMath();
    }

    function selectQuizOption(idx, btn) {
        document.querySelectorAll('#quiz-options-container .btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        userAnswers[currentQuizIndex] = idx;
        const nextBtn = document.getElementById('quiz-next-btn');
        nextBtn.style.display = 'block';
        if (currentQuizIndex === questionBank.length - 1) {
            nextBtn.innerText = "æäº¤è¯•å·";
            nextBtn.onclick = submitQuiz;
        } else {
            nextBtn.innerText = "ä¸‹ä¸€é¢˜";
            nextBtn.onclick = () => { currentQuizIndex++; loadQuizQuestion(); };
        }
    }

    function submitQuiz() {
        wrongIndices = [];
        questionBank.forEach((q, idx) => {
            if (userAnswers[idx] !== q.correct) wrongIndices.push(idx);
        });
        if (wrongIndices.length === 0) showResult(true);
        else {
            alert(`è¯Šæ–­å‡º ${wrongIndices.length} ä¸ªé€»è¾‘æ–­ç‚¹ï¼Œè¿›å…¥æ™ºèƒ½ä¿®å¤ã€‚`);
            startRemediation();
        }
    }

    function startRemediation() {
        currentRemedyIndex = 0;
        criticalFailures = 0;
        switchScene('scene-remedy');
        loadRemedyItem();
    }

    function loadRemedyItem() {
        const idx = wrongIndices[currentRemedyIndex];
        const data = questionBank[idx];
        document.getElementById('remedy-original-question').innerHTML = data.question;
        document.getElementById('remedy-explanation').innerHTML = data.remediation.explanation;
        document.getElementById('variant-question-text').innerHTML = data.remediation.variant.question;
        document.getElementById('deep-dive-box').style.display = 'none';
        document.getElementById('remedy-next-btn').style.display = 'none';
        document.getElementById('variant-feedback').innerHTML = '';
        renderVariantOptions(data, false);
        renderMath();
    }

    function renderVariantOptions(data, isRetry) {
        const container = document.getElementById('variant-options-container');
        container.innerHTML = '';
        data.remediation.variant.options.forEach((opt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'btn btn-opt';
            btn.innerHTML = opt;
            btn.onclick = () => checkVariantAnswer(idx, btn, data, isRetry);
            container.appendChild(btn);
        });
        renderMath();
    }

    function checkVariantAnswer(userIdx, btn, data, isRetry) {
        const correctIdx = data.remediation.variant.correct;
        const allBtns = document.querySelectorAll('#variant-options-container .btn');
        allBtns.forEach(b => b.classList.add('disabled'));

        if (userIdx === correctIdx) {
            btn.style.backgroundColor = '#dcedc8'; btn.style.borderColor = '#00695c';
            document.getElementById('variant-feedback').innerHTML = '<span style="color:green">âœ… é€»è¾‘å·²æ‰“é€šï¼</span>';
            document.getElementById('remedy-next-btn').style.display = 'inline-block';
        } else {
            btn.style.backgroundColor = '#ffcdd2'; btn.style.borderColor = '#c62828';
            if (!isRetry) {
                document.getElementById('variant-feedback').innerHTML = '<span style="color:#c62828">âŒ è¿˜æ˜¯æ··æ·†ï¼Ÿè¯·çœ‹ä¸‹æ–¹çš„ã€åˆ†æ­¥æ‹†è§£ã€‘ã€‚ğŸ‘‡</span>';
                showDeepDive(data);
            } else {
                criticalFailures++;
                allBtns[correctIdx].style.backgroundColor = '#dcedc8';
                document.getElementById('variant-feedback').innerHTML = '<span style="color:red">ğŸ†˜ æ­¤çŸ¥è¯†ç‚¹éœ€è¦è€å¸ˆè®²è§£ï¼ˆå»ºè®®å¤ä¹ æ–¹ç¨‹ç« èŠ‚ï¼‰ã€‚</span>';
                document.getElementById('remedy-next-btn').style.display = 'inline-block';
            }
        }
    }

    function showDeepDive(data) {
        const box = document.getElementById('deep-dive-box');
        const stepsDiv = document.getElementById('deep-steps');
        stepsDiv.innerHTML = '';
        data.remediation.stepByStep.forEach(step => {
            const div = document.createElement('div');
            div.className = 'step-item';
            div.innerHTML = step;
            stepsDiv.appendChild(div);
        });
        box.style.display = 'block';
        renderMath();
        box.scrollIntoView({behavior: "smooth"});
    }

    function retryVariant() {
        const idx = wrongIndices[currentRemedyIndex];
        const data = questionBank[idx];
        document.getElementById('deep-dive-box').style.display = 'none';
        document.getElementById('variant-feedback').innerHTML = '';
        renderVariantOptions(data, true);
    }

    function nextRemedyItem() {
        currentRemedyIndex++;
        if (currentRemedyIndex < wrongIndices.length) loadRemedyItem();
        else showResult(false);
    }

    function showResult(isPerfect) {
        switchScene('scene-result');
        const div = document.getElementById('result-details');
        if (isPerfect) {
            div.innerHTML = "<h3 style='color:green'>Bçº§èä¼šè´¯é€šï¼ğŸ‰</h3><p>ä½ å·²ç»æˆåŠŸæ‰“é€šäº†ä»£æ•°ä¸å‡ ä½•çš„æ¡¥æ¢ï¼</p>";
        } else {
            let html = `<p>åˆæµ‹å¾—åˆ†ï¼š${questionBank.length - wrongIndices.length} / ${questionBank.length}</p>`;
            html += `<p>é‡è¿äº† ${wrongIndices.length} ä¸ªé€»è¾‘æ–­ç‚¹ã€‚</p>`;
            if (criticalFailures > 0) {
                html += `<div style="background:#ffebee; padding:10px; border-left:4px solid red; margin-top:10px;"><strong>ğŸš¨ æ³¨æ„ï¼š</strong> æœ‰ ${criticalFailures} ä¸ªé—®é¢˜ä¾ç„¶æœªè§£å†³ã€‚</div>`;
            } else {
                html += `<div style="background:#e8f5e9; padding:10px; border-left:4px solid green; margin-top:10px;">âœ… æ‰€æœ‰é€»è¾‘æ–­ç‚¹å·²ä¿®å¤ã€‚</div>`;
            }
            div.innerHTML = html;
        }
    }

    function switchScene(id) {
        document.querySelectorAll('.scene').forEach(e => e.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        window.scrollTo(0, 0);
    }
    
    function renderMath() {
        if (typeof MathJax !== 'undefined' && MathJax.typesetPromise) MathJax.typesetPromise();
    }
</script>

</body>
</html>